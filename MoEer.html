<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‘©å°”æŠ•ç¥¨ç®—æ³•å¯è§†åŒ–æ•™å­¦</title>
    <style>
        :root {
            --primary: #3b82f6;
            --success: #22c55e;
            --danger: #ef4444;
            --gray: #e5e7eb;
            --dark: #1f2937;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f3f4f6;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }

        h1 { margin-bottom: 10px; }

        /* æ§åˆ¶åŒº */
        .controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 250px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-start { background-color: var(--primary); color: white; }
        .btn-step { background-color: var(--success); color: white; }
        .btn-reset { background-color: var(--danger); color: white; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

        /* å¯è§†åŒ–é¢æ¿ */
        .stage {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 900px;
            justify-content: center;
        }

        /* çŠ¶æ€å¡ç‰‡ */
        .status-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 200px;
            text-align: center;
            border-top: 5px solid var(--primary);
        }

        .status-value { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }
        .status-label { color: #666; font-size: 0.9rem; }

        /* æ•°ç»„å±•ç¤ºåŒº */
        .array-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            min-height: 80px;
        }

        .num-box {
            width: 60px;
            height: 60px;
            background-color: white;
            border: 2px solid var(--gray);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
        }

        /* å„ç§çŠ¶æ€çš„æ ·å¼ */
        .num-box.active {
            border-color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            z-index: 10;
        }
        
        .num-box.processed {
            background-color: #f9fafb;
            color: #9ca3af;
            border-color: #e5e7eb;
        }

        /* åŠ¨ç”»ç±» */
        .highlight-green { background-color: #dcfce7 !important; border-color: var(--success) !important; color: var(--success); }
        .highlight-red { background-color: #fee2e2 !important; border-color: var(--danger) !important; color: var(--danger); }
        .highlight-blue { background-color: #dbeafe !important; border-color: var(--primary) !important; color: var(--primary); }

        /* è§£è¯´æ—¥å¿— */
        .log-box {
            width: 100%;
            max-width: 800px;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            min-height: 100px;
            border-left: 5px solid #666;
            font-size: 1.1rem;
            line-height: 1.6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .log-highlight { font-weight: bold; padding: 2px 6px; border-radius: 4px; }
        .log-tag { display: inline-block; padding: 2px 8px; border-radius: 12px; color: white; font-size: 0.8rem; margin-right: 8px; vertical-align: middle;}
    </style>
</head>
<body>

    <h1>ğŸ° æ‘©å°”æŠ•ç¥¨ç®—æ³•å¯è§†åŒ–</h1>
    <p style="color:#666; margin-bottom: 20px;">æ ¸å¿ƒæ€æƒ³ï¼šä¸åŒé˜µè¥å£«å…µä¸€æ¢ä¸€ï¼Œå‰©ä¸‹çš„å³ä¸ºä¼—æ•°</p>

    <div class="controls">
        <label>æ•°ç»„è¾“å…¥ (ç”¨é€—å·åˆ†éš”):</label>
        <input type="text" id="inputArray" value="2, 2, 1, 1, 1, 2, 2">
        <button class="btn-start" onclick="init()">ğŸ”„ é‡ç½® / åŠ è½½</button>
        <div style="width: 20px;"></div>
        <button class="btn-step" id="btnNext" onclick="nextStep()" disabled>â© ä¸‹ä¸€æ­¥</button>
        <button style="background-color: #8b5cf6; color: white;" id="btnAuto" onclick="toggleAutoPlay()" disabled>â–¶ è‡ªåŠ¨æ’­æ”¾</button>
    </div>

    <!-- çŠ¶æ€é¢æ¿ -->
    <div class="stage">
        <div class="status-card">
            <div class="status-label">å½“å‰å€™é€‰äºº (Candidate)</div>
            <div class="status-value" id="dispCand" style="color: var(--primary)">None</div>
        </div>
        <div class="status-card">
            <div class="status-label">å½“å‰ç¥¨æ•° (Count)</div>
            <div class="status-value" id="dispCount">0</div>
        </div>
    </div>

    <!-- æ•°ç»„å¯è§†åŒ– -->
    <div class="array-container" id="arrayContainer">
        <!-- JS ç”Ÿæˆæ–¹å— -->
    </div>

    <!-- æ•™å­¦è§£è¯´ -->
    <div class="log-box" id="logText">
        è¯·ç‚¹å‡» [é‡ç½®/åŠ è½½] å¼€å§‹æ¼”ç¤ºã€‚
    </div>

    <script>
        // æ ¸å¿ƒå˜é‡
        let nums = [];
        let currentIndex = -1;
        let candidate = null;
        let count = 0;
        let autoPlayTimer = null;

        // åˆå§‹åŒ–
        function init() {
            stopAutoPlay();
            const input = document.getElementById('inputArray').value;
            // å¤„ç†å…¨è§’é€—å·å’Œç©ºæ ¼
            nums = input.split(/[,ï¼Œ]/).map(s => s.trim()).filter(s => s !== "").map(Number);
            
            if (nums.length === 0) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—æ•°ç»„");
                return;
            }

            currentIndex = -1;
            candidate = null;
            count = 0;

            renderArray();
            updateStats();
            updateLog("å‡†å¤‡å°±ç»ªï¼ç‚¹å‡» [ä¸‹ä¸€æ­¥] å¼€å§‹éå†ã€‚", "gray");

            document.getElementById('btnNext').disabled = false;
            document.getElementById('btnAuto').disabled = false;
        }

        // æ¸²æŸ“æ•°ç»„ DOM
        function renderArray() {
            const container = document.getElementById('arrayContainer');
            container.innerHTML = '';
            nums.forEach((n, i) => {
                const box = document.createElement('div');
                box.className = 'num-box';
                box.id = `box-${i}`;
                box.innerText = n;
                container.appendChild(box);
            });
        }

        // æ›´æ–°çŠ¶æ€é¢æ¿
        function updateStats() {
            const candEl = document.getElementById('dispCand');
            const countEl = document.getElementById('dispCount');
            
            candEl.innerText = candidate === null ? "None" : candidate;
            countEl.innerText = count;

            // ç®€å•çš„é¢œè‰²åé¦ˆ
            if(count > 0) countEl.style.color = "var(--success)";
            else countEl.style.color = "var(--dark)";
        }

        // æ ¸å¿ƒé€»è¾‘ï¼šä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentIndex >= nums.length - 1) {
                finish();
                return;
            }

            // 1. æ¸…ç†ä¸Šä¸€æ­¥çš„é«˜äº®
            if (currentIndex >= 0) {
                const prevBox = document.getElementById(`box-${currentIndex}`);
                prevBox.className = 'num-box processed';
            }

            // 2. ç§»åŠ¨æŒ‡é’ˆ
            currentIndex++;
            const currentVal = nums[currentIndex];
            const currentBox = document.getElementById(`box-${currentIndex}`);
            
            // åŸºç¡€æ¿€æ´»æ ·å¼
            currentBox.classList.add('active');

            // 3. ç®—æ³•é€»è¾‘
            let logMsg = "";
            let tagColor = "";
            let tagName = "";

            if (count === 0) {
                // æƒ…å†µAï¼šæ›´æ¢å€™é€‰äºº
                candidate = currentVal;
                count = 1;
                
                tagName = "æ›´æ¢ä¸»å¸…";
                tagColor = "#3b82f6"; // Blue
                logMsg = `ç¥¨æ•°ä¸º 0ã€‚å½“å‰æ•°å­— <b>${currentVal}</b> æˆä¸ºæ–°çš„å€™é€‰äººï¼Œç¥¨æ•°é‡ç½®ä¸º 1ã€‚`;
                
                currentBox.classList.add('highlight-blue');
                flashStatus('dispCand');
            } else if (candidate === currentVal) {
                // æƒ…å†µBï¼šç¥¨æ•°å¢åŠ 
                count++;
                
                tagName = "æ´å†›åˆ°è¾¾";
                tagColor = "#22c55e"; // Green
                logMsg = `å½“å‰æ•°å­— <b>${currentVal}</b> ç­‰äºå€™é€‰äººã€‚ç¥¨æ•° +1ã€‚`;
                
                currentBox.classList.add('highlight-green');
                flashStatus('dispCount');
            } else {
                // æƒ…å†µCï¼šç›¸äº’æŠµæ¶ˆ
                count--;
                
                tagName = "åŒå½’äºå°½";
                tagColor = "#ef4444"; // Red
                logMsg = `å½“å‰æ•°å­— <b>${currentVal}</b> ä¸ç­‰äºå€™é€‰äºº <b>${candidate}</b>ã€‚å‘ç”ŸæŠµæ¶ˆï¼Œç¥¨æ•° -1ã€‚`;
                
                currentBox.classList.add('highlight-red');
                flashStatus('dispCount');
            }

            updateStats();
            updateLogHTML(tagName, tagColor, logMsg);

            // å¦‚æœæ˜¯æœ€åä¸€æ­¥
            if (currentIndex === nums.length - 1) {
                document.getElementById('btnNext').innerText = "æŸ¥çœ‹ç»“æœ";
            }
        }

        // ç»“æŸå¤„ç†
        function finish() {
            if (currentIndex >= 0) {
                 document.getElementById(`box-${currentIndex}`).className = 'num-box processed';
            }
            updateLogHTML("ç»“æŸ", "#1f2937", `éå†å®Œæˆï¼æœ€ç»ˆç•™ä¸‹çš„å€™é€‰äººæ˜¯ <b style="font-size:1.5rem; color:var(--primary)">${candidate}</b>`);
            document.getElementById('btnNext').disabled = true;
            document.getElementById('btnAuto').disabled = true;
            stopAutoPlay();
        }

        // è¾…åŠ©ï¼šæ›´æ–°æ—¥å¿—
        function updateLog(msg, color) {
            const logBox = document.getElementById('logText');
            logBox.style.borderLeftColor = color;
            logBox.innerText = msg;
        }

        function updateLogHTML(tag, color, htmlMsg) {
            const logBox = document.getElementById('logText');
            logBox.style.borderLeftColor = color;
            logBox.innerHTML = `<span class="log-tag" style="background:${color}">${tag}</span> ${htmlMsg}`;
        }

        // è¾…åŠ©ï¼šçŠ¶æ€é—ªçƒåŠ¨ç”»
        function flashStatus(id) {
            const el = document.getElementById(id);
            el.style.transform = "scale(1.2)";
            setTimeout(() => el.style.transform = "scale(1)", 200);
        }

        // è‡ªåŠ¨æ’­æ”¾é€»è¾‘
        function toggleAutoPlay() {
            if (autoPlayTimer) {
                stopAutoPlay();
            } else {
                document.getElementById('btnAuto').innerText = "â¸ æš‚åœ";
                document.getElementById('btnAuto').style.backgroundColor = "#666";
                // ç«‹å³æ‰§è¡Œä¸€æ­¥ï¼Œç„¶åå®šæ—¶
                nextStep();
                autoPlayTimer = setInterval(() => {
                    if (document.getElementById('btnNext').disabled) {
                        stopAutoPlay();
                    } else {
                        nextStep();
                    }
                }, 1000); // 1ç§’ä¸€æ­¥
            }
        }

        function stopAutoPlay() {
            if (autoPlayTimer) {
                clearInterval(autoPlayTimer);
                autoPlayTimer = null;
            }
            document.getElementById('btnAuto').innerText = "â–¶ è‡ªåŠ¨æ’­æ”¾";
            document.getElementById('btnAuto').style.backgroundColor = "#8b5cf6";
        }

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>